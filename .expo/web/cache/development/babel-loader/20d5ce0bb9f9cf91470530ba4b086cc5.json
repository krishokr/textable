{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport * as ImagePicker from 'expo-image-picker';\nimport { Camera } from 'expo-camera';\nimport { Audio } from 'expo-av';\nimport * as Location from 'expo-location';\nimport { getStorage, ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nvar CustomActions = function (_Component) {\n  _inherits(CustomActions, _Component);\n\n  var _super = _createSuper(CustomActions);\n\n  function CustomActions() {\n    var _this;\n\n    _classCallCheck(this, CustomActions);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      image: {},\n      location: {}\n    };\n\n    _this.getLocation = function _callee() {\n      var _await$Location$reque, status, result, latitude, longitude;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Location.requestForegroundPermissionsAsync());\n\n            case 2:\n              _await$Location$reque = _context.sent;\n              status = _await$Location$reque.status;\n\n              if (!(status === 'granted')) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n            case 7:\n              result = _context.sent;\n\n              if (!result.cancelled) {\n                console.log('This is the location: ');\n                latitude = JSON.stringify(result.coords.latitude);\n                longitude = JSON.stringify(result.coords.longitude);\n\n                _this.props.onSend([{\n                  location: {\n                    latitude: latitude,\n                    longitude: longitude\n                  },\n                  text: \"Latitude: \" + latitude + \",\\nLongitude: \" + longitude\n                }]);\n              }\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.uploadImageFetch = function _callee3(uri) {\n      var blob, imageNameBefore, imageName, storage, storageRef;\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(new Promise(function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n\n                xhr.onload = function () {\n                  resolve(xhr.response);\n                };\n\n                xhr.onerror = function (e) {\n                  console.log(e);\n                  reject(new TypeError('Network request failed.'));\n                };\n\n                xhr.responseType = 'blob';\n                xhr.open('GET', uri, true);\n                xhr.send(null);\n              }));\n\n            case 2:\n              blob = _context3.sent;\n              imageNameBefore = uri.split(\"/\");\n              imageName = imageNameBefore[imageNameBefore.length - 1];\n              storage = getStorage();\n              storageRef = ref(storage, \"images/\" + imageName);\n              _context3.next = 9;\n              return _regeneratorRuntime.awrap(uploadBytes(storageRef, blob).then(function _callee2(snapshot) {\n                return _regeneratorRuntime.async(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        console.log('file has been uploaded.');\n                        _context2.next = 3;\n                        return _regeneratorRuntime.awrap(getDownloadURL(snapshot.ref).then(function (url) {\n                          return url;\n                        }).catch(function (err) {\n                          return console.log(err);\n                        }));\n\n                      case 3:\n                        return _context2.abrupt(\"return\", _context2.sent);\n\n                      case 4:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              }));\n\n            case 9:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.imagePicker = function _callee4() {\n      var _await$Camera$request, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestCameraPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context4.sent;\n              status = _await$Camera$request.status;\n              _context4.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context4.next = 14;\n                break;\n              }\n\n              _context4.next = 8;\n              return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.Images\n              }).catch(function (error) {\n                return console.log(error);\n              }));\n\n            case 8:\n              result = _context4.sent;\n\n              if (result.cancelled) {\n                _context4.next = 14;\n                break;\n              }\n\n              _context4.next = 12;\n              return _regeneratorRuntime.awrap(_this.uploadImageFetch(result.uri));\n\n            case 12:\n              imageUrl = _context4.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 14:\n              _context4.next = 19;\n              break;\n\n            case 16:\n              _context4.prev = 16;\n              _context4.t0 = _context4[\"catch\"](4);\n              console.log(_context4.t0.message);\n\n            case 19:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, [[4, 16]], Promise);\n    };\n\n    _this.takePhoto = function _callee5() {\n      var _await$Camera$request2, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestCameraPermissionsAsync());\n\n            case 2:\n              _await$Camera$request2 = _context5.sent;\n              status = _await$Camera$request2.status;\n\n              if (!(status === 'granted')) {\n                _context5.next = 13;\n                break;\n              }\n\n              _context5.next = 7;\n              return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync({\n                mediaTypes: 'Images'\n              }).catch(function (error) {\n                return console.log(error);\n              }));\n\n            case 7:\n              result = _context5.sent;\n\n              if (result.cancelled) {\n                _context5.next = 13;\n                break;\n              }\n\n              _context5.next = 11;\n              return _regeneratorRuntime.awrap(_this.uploadImageFetch(result.uri));\n\n            case 11:\n              imageUrl = _context5.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 13:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.onActionPress = function () {\n      var options = ['Choose from library', 'Take Picture', 'Send Location', 'Cancel'];\n      var cancelButtonIndex = options.length - 1;\n\n      _this.context.actionSheet().showActionSheetWithOptions({\n        options: options,\n        cancelButtonIndex: cancelButtonIndex\n      }, function _callee6(buttonIndex) {\n        return _regeneratorRuntime.async(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.t0 = buttonIndex;\n                _context6.next = _context6.t0 === 0 ? 3 : _context6.t0 === 1 ? 4 : _context6.t0 === 2 ? 5 : 6;\n                break;\n\n              case 3:\n                return _context6.abrupt(\"return\", _this.imagePicker());\n\n              case 4:\n                return _context6.abrupt(\"return\", _this.takePhoto());\n\n              case 5:\n                return _context6.abrupt(\"return\", _this.getLocation());\n\n              case 6:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(CustomActions, [{\n    key: \"render\",\n    value: function render() {\n      return _jsx(TouchableOpacity, {\n        style: styles.container,\n        onPress: this.onActionPress,\n        children: _jsx(View, {\n          style: [styles.wrapper, this.props.wrapperStyle],\n          children: _jsx(Text, {\n            style: [styles.iconText, this.props.iconTextStyle],\n            children: \"+\"\n          })\n        })\n      });\n    }\n  }]);\n\n  return CustomActions;\n}(Component);\n\nexport { CustomActions as default };\nvar styles = StyleSheet.create({\n  container: {\n    width: 26,\n    height: 26,\n    marginLeft: 10,\n    marginBottom: 10\n  },\n  wrapper: {\n    borderRadius: 13,\n    borderColor: '#b2b2b2',\n    borderWidth: 2,\n    flex: 1\n  },\n  iconText: {\n    color: '#b2b2b2',\n    fontWeight: 'bold',\n    fontSize: 16,\n    backgroundColor: 'transparent',\n    textAlign: 'center'\n  }\n});\nCustomActions.contextTypes = {\n  actionSheet: PropTypes.func\n};","map":{"version":3,"sources":["/Users/krishokr/textable/components/CustomActions.js"],"names":["React","Component","PropTypes","ImagePicker","Camera","Audio","Location","getStorage","ref","uploadBytes","getDownloadURL","CustomActions","state","image","location","getLocation","requestForegroundPermissionsAsync","status","getCurrentPositionAsync","result","cancelled","console","log","latitude","JSON","stringify","coords","longitude","props","onSend","text","uploadImageFetch","uri","Promise","resolve","reject","xhr","XMLHttpRequest","onload","response","onerror","e","TypeError","responseType","open","send","blob","imageNameBefore","split","imageName","length","storage","storageRef","then","snapshot","url","catch","err","imagePicker","requestCameraPermissionsAsync","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","error","imageUrl","message","takePhoto","launchCameraAsync","onActionPress","options","cancelButtonIndex","context","actionSheet","showActionSheetWithOptions","buttonIndex","styles","container","wrapper","wrapperStyle","iconText","iconTextStyle","StyleSheet","create","width","height","marginLeft","marginBottom","borderRadius","borderColor","borderWidth","flex","color","fontWeight","fontSize","backgroundColor","textAlign","contextTypes","func"],"mappings":"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","sourcesContent":["import { Text, View, StyleSheet, TouchableOpacity} from 'react-native'\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport * as ImagePicker from 'expo-image-picker';\nimport { Camera } from 'expo-camera';\nimport { Audio } from 'expo-av';\nimport * as Location from 'expo-location';\nimport {getStorage, ref, uploadBytes, getDownloadURL} from 'firebase/storage';\n\nexport default class CustomActions extends Component {\n\n    state = {\n        image: {},\n        location: {}\n    }\n\n    getLocation = async () => {\n        const {status} = await Location.requestForegroundPermissionsAsync();\n        if (status === 'granted') {\n            let result = await Location.getCurrentPositionAsync({});\n            if (!result.cancelled) {\n                console.log('This is the location: ');\n                const latitude = JSON.stringify(result.coords.latitude);\n                const longitude = JSON.stringify(result.coords.longitude);\n           \n                \n                this.props.onSend([{location: {latitude, longitude}, text: `Latitude: ${latitude},\\nLongitude: ${longitude}`}]);\n\n            }\n        }\n    }\n\n    uploadImageFetch = async (uri) => {\n        const blob = await new Promise ((resolve,reject) => {\n            const xhr = new XMLHttpRequest();\n            xhr.onload = function() {\n                resolve(xhr.response)\n            };\n            xhr.onerror = function(e) {\n                console.log(e);\n                reject(new TypeError('Network request failed.'))\n            }\n            xhr.responseType = 'blob';\n            xhr.open('GET', uri, true);\n            xhr.send(null);\n        });\n\n        const imageNameBefore = uri.split(\"/\");\n        const imageName = imageNameBefore[imageNameBefore.length - 1];\n\n        const storage = getStorage();\n\n        const storageRef = ref(storage, `images/${imageName}`);\n\n\n        return await uploadBytes(storageRef, blob).then(async snapshot => {\n            console.log('file has been uploaded.');\n            return await getDownloadURL(snapshot.ref).then(url => {\n                return url\n            }).catch(err => console.log(err))\n        })\n        \n\n    }\n\n    imagePicker = async () => {\n\n        const { status } = await Camera.requestCameraPermissionsAsync();\n        try {\n          if (status === \"granted\") {\n            const result = await ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.Images\n            }).catch((error) => console.log(error));\n\n            if (!result.cancelled) {\n              const imageUrl = await this.uploadImageFetch(result.uri);\n              this.props.onSend({ image: imageUrl });\n            }\n          }\n        } catch (error) {\n          console.log(error.message);\n        }\n    };\n\n    takePhoto = async () => {\n        const { status } = await Camera.requestCameraPermissionsAsync();\n\n        if (status === 'granted') {\n            const result = await ImagePicker.launchCameraAsync({\n                mediaTypes: 'Images'\n            }).catch(error => console.log(error));\n\n            if (!result.cancelled) {\n                const imageUrl = await this.uploadImageFetch(result.uri);\n                this.props.onSend({ image: imageUrl });\n            }\n        }\n\n    };\n    \n    onActionPress = () => {\n        const options = ['Choose from library', 'Take Picture', 'Send Location', 'Cancel'];\n        const cancelButtonIndex = options.length-1;\n        this.context.actionSheet().showActionSheetWithOptions({\n            options,\n            cancelButtonIndex\n        },\n        async (buttonIndex) => {\n            switch(buttonIndex) {\n                case 0:\n                    return this.imagePicker()\n                case 1:\n                    return this.takePhoto()\n                case 2:\n                    return this.getLocation()\n                default:\n            }\n        })\n    }\n    render() {\n        return (\n            <TouchableOpacity style={styles.container} onPress={this.onActionPress}>\n                <View style={[styles.wrapper, this.props.wrapperStyle]}>\n                    <Text style={[styles.iconText, this.props.iconTextStyle]}>+</Text>\n                </View>\n            </TouchableOpacity>\n        )\n    }\n}\n  \n\n\nconst styles = StyleSheet.create({\n    container: {\n      width: 26,\n      height: 26,\n      marginLeft: 10,\n      marginBottom: 10,\n    },\n    wrapper: {\n      borderRadius: 13,\n      borderColor: '#b2b2b2',\n      borderWidth: 2,\n      flex: 1,\n    },\n    iconText: {\n      color: '#b2b2b2',\n      fontWeight: 'bold',\n      fontSize: 16,\n      backgroundColor: 'transparent',\n      textAlign: 'center',\n    },\n   });\n\nCustomActions.contextTypes = {\nactionSheet: PropTypes.func,\n};"]},"metadata":{},"sourceType":"module"}